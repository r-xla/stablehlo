<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get Started • stablehlo</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Started">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stablehlo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/stablehlo.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-xla/stablehlo/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-xla/stablehlo/blob/fix-clamp/vignettes/articles/stablehlo.Rmd" class="external-link"><code>vignettes/articles/stablehlo.Rmd</code></a></small>
      <div class="d-none name"><code>stablehlo.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we will give an overview of the {stablehlo} package
and show how it can be used to create StableHLO programs. If you are not
familiar with StableHLO, we recommend reading the <a href="https://openxla.org/stablehlo/spec" class="external-link">StableHLO specification</a>
first.</p>
<p>The {stablehlo} package represents StableHLO programs as nested S7
objects. When working with the package, you usually don’t construct
these objects via their <code>S7</code>-constructor, but through the
more user-friendly <code>hlo_&lt;name&gt;</code> functions.</p>
<p>We start by creating a <code>Func</code> object that represents a
StableHLO function. Such a <code>Func</code> object has an ID
(<code>FuncId</code>), inputs (<code>FuncInputs</code>), outputs
(<code>FuncOutputs</code>) and a body (<code>FuncBody</code>). Below, we
are calling our function <code>"main"</code> and create an empty
function via <code><a href="../reference/hlo_func.html">local_func()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-xla.github.io/stablehlo/" class="external-link">stablehlo</a></span><span class="op">)</span></span>
<span><span class="va">main_func</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_func.html">local_func</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">main_func</span></span>
<span><span class="co">#&gt; func.func @main () -&gt;  {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>This <code>Func</code> object is now accessible via
<code><a href="../reference/dot-current_func.html">.current_func()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dot-current_func.html">.current_func</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; func.func @main () -&gt;  {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>When we exit the scope where <code>func</code> was created and we
haven’t finished building the function (via <code><a href="../reference/hlo_return.html">hlo_return()</a></code>,
see later), this global state will be cleaned up. If you don’t want
this, use <code><a href="../reference/hlo_func.html">hlo_func()</a></code>, but unless you have a good reason to
do so, you should use <code><a href="../reference/hlo_func.html">local_func()</a></code>.</p>
<p>To convert this (unfinished) function into its stableHLO string
representation, we can use the <code>repr</code> method, which is also
called when printing the <code>Func</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/repr.html">repr</a></span><span class="op">(</span><span class="va">main_func</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "func.func @main () -&gt;  {\n\n}\n"</span></span></code></pre></div>
<p>We can now add inputs to the function, which will populate the
<code>FuncInputs</code> of the <code>Func</code>. We create two inputs,
<code>x</code> and <code>y</code>, and add them to the function via
<code><a href="../reference/hlo_input.html">hlo_input()</a></code>. We start by adding an argument <code>x</code>,
which is a <code>2x2xf32</code> tensor.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_input.html">hlo_input</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"f32"</span>, shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, func <span class="op">=</span> <span class="va">main_func</span><span class="op">)</span></span></code></pre></div>
<p>We don’t have to specify the <code>func</code> argument explicitly,
because the default is to use <code><a href="../reference/dot-current_func.html">.current_func()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_input.html">hlo_input</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"f32"</span>, shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The R variables <code>x</code> and <code>y</code> are now wrapped in
a <code>FuncValue</code> object. Such a <code>FuncValue</code>
represents a value in a stableHLO function and contains:</p>
<ol style="list-style-type: decimal">
<li>The <code>ValueId</code> of the value.</li>
<li>The <code>ValueType</code> of the value.</li>
<li>The <code>Func</code> object that the value belongs to.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span>
<span><span class="co">#&gt; Variable <span style="color: #0000BB;">%x</span> in:</span></span>
<span><span class="co">#&gt; func.func @main (<span style="color: #0000BB;">%x</span>: tensor&lt;2x2xf32&gt;, %y: tensor&lt;2x2xf32&gt;) -&gt;  {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="va">x</span><span class="op">@</span><span class="va">value_id</span></span>
<span><span class="co">#&gt; &lt;stablehlo::ValueId&gt;</span></span>
<span><span class="co">#&gt;  @ id: chr "x"</span></span>
<span><span class="va">x</span><span class="op">@</span><span class="va">value_type</span></span>
<span><span class="co">#&gt; &lt;stablehlo::ValueType&gt;</span></span>
<span><span class="co">#&gt;  @ type: &lt;stablehlo::TensorType&gt;</span></span>
<span><span class="co">#&gt;  .. @ dtype: &lt;stablehlo::FloatType&gt;</span></span>
<span><span class="co">#&gt;  .. .. @ value: int 32</span></span>
<span><span class="co">#&gt;  .. @ shape: &lt;stablehlo::Shape&gt;</span></span>
<span><span class="co">#&gt;  .. .. @ dims: int [1:2] 2 2</span></span>
<span><span class="va">x</span><span class="op">@</span><span class="va">func</span></span>
<span><span class="co">#&gt; func.func @main (%x: tensor&lt;2x2xf32&gt;, %y: tensor&lt;2x2xf32&gt;) -&gt;  {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>Next, we will populate the body of the function with operations. We
will start by adding the values of <code>x</code> and <code>y</code>
together. Because <code>Func</code> is a reference object, this also
updates the <code>main_func</code> from above.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_add.html">hlo_add</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="va">z</span></span>
<span><span class="co">#&gt; Variable <span style="color: #0000BB;">%0</span> in:</span></span>
<span><span class="co">#&gt; func.func @main (%x: tensor&lt;2x2xf32&gt;, %y: tensor&lt;2x2xf32&gt;) -&gt;  {</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">%0</span> = "stablehlo.add" (%x, %y): (tensor&lt;2x2xf32&gt;, tensor&lt;2x2xf32&gt;) -&gt; (tensor&lt;2x2xf32&gt;)</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>The identifier of <code>z</code> (its <code>ValueId</code>) is
automatically generated and you don’t have to specify it explicitly.
Next, we concatenate <code>z</code> and <code>x</code> together along
the second dimension (note that the dimension is 0-based in
stableHLO).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_concatenate.html">hlo_concatenate</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">x</span>, dimension <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span>
<span><span class="va">w</span></span>
<span><span class="co">#&gt; Variable <span style="color: #0000BB;">%1</span> in:</span></span>
<span><span class="co">#&gt; func.func @main (%x: tensor&lt;2x2xf32&gt;, %y: tensor&lt;2x2xf32&gt;) -&gt;  {</span></span>
<span><span class="co">#&gt; %0 = "stablehlo.add" (%x, %y): (tensor&lt;2x2xf32&gt;, tensor&lt;2x2xf32&gt;) -&gt; (tensor&lt;2x2xf32&gt;)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">%1</span> = "stablehlo.concatenate" (%0, %x) {</span></span>
<span><span class="co">#&gt; dimension = 1 : i64</span></span>
<span><span class="co">#&gt; }: (tensor&lt;2x2xf32&gt;, tensor&lt;2x2xf32&gt;) -&gt; (tensor&lt;2x4xf32&gt;)</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>We see above that the inputs to operations can not only be tensors,
but also other, “static” inputs. Inputs are static when they can’t be
changed during execution. Static inputs are either tensors (scalars are
0-dimensional tensors), or functions. To demonstrate using a function,
we create another (unnamed) function via <code><a href="../reference/hlo_func.html">local_func()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reduce_func</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_func.html">local_func</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_input.html">hlo_input</a></span><span class="op">(</span><span class="st">"z1"</span>, <span class="st">"f32"</span>, shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">z2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_input.html">hlo_input</a></span><span class="op">(</span><span class="st">"z2"</span>, <span class="st">"f32"</span>, shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Because our <code><a href="../reference/dot-current_func.html">.current_func()</a></code> is now
<code>reduce_func</code>, the inputs are added to
<code>reduce_func</code> and not <code>func</code>. If we wanted to add
them to <code>main_func</code>, we would have to explicitly specify
<code>func = main_func</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dot-current_func.html">.current_func</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; func.func @main (%z1: tensor&lt;f32&gt;, %z2: tensor&lt;f32&gt;) -&gt;  {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="va">reduce_func</span></span>
<span><span class="co">#&gt; func.func @main (%z1: tensor&lt;f32&gt;, %z2: tensor&lt;f32&gt;) -&gt;  {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>Our reduction operation will just add <code>z1</code> and
<code>z2</code> together.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_reduce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_add.html">hlo_add</a></span><span class="op">(</span><span class="va">z1</span>, <span class="va">z2</span><span class="op">)</span></span>
<span><span class="va">out_reduce</span></span>
<span><span class="co">#&gt; Variable <span style="color: #0000BB;">%0</span> in:</span></span>
<span><span class="co">#&gt; func.func @main (%z1: tensor&lt;f32&gt;, %z2: tensor&lt;f32&gt;) -&gt;  {</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">%0</span> = "stablehlo.add" (%z1, %z2): (tensor&lt;f32&gt;, tensor&lt;f32&gt;) -&gt; (tensor&lt;f32&gt;)</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>Now we are done specifying the body of the reduction function, so we
can return the result via <code><a href="../reference/hlo_return.html">hlo_return()</a></code>. You should only
call this once you are done building the function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hlo_return.html">hlo_return</a></span><span class="op">(</span><span class="va">out_reduce</span><span class="op">)</span></span>
<span><span class="co">#&gt; func.func @main (%z1: tensor&lt;f32&gt;, %z2: tensor&lt;f32&gt;) -&gt; tensor&lt;f32&gt; {</span></span>
<span><span class="co">#&gt; %0 = "stablehlo.add" (%z1, %z2): (tensor&lt;f32&gt;, tensor&lt;f32&gt;) -&gt; (tensor&lt;f32&gt;)</span></span>
<span><span class="co">#&gt; "func.return"(%0): (tensor&lt;f32&gt;) -&gt; ()</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>The output of <code>hlo_return</code> is the same (identical) object
as the <code>reduce_func</code> (<code>Func</code>s are reference
objects).</p>
<p>In order to specify the reduce operation in our main body, we now
only need to define an initial scalar value of the same type as the
tensor we are reducing. We can do this via
<code><a href="../reference/hlo_constant.html">hlo_scalar()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_constant.html">hlo_scalar</a></span><span class="op">(</span><span class="fl">0</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span><span class="va">init</span></span>
<span><span class="co">#&gt; Variable <span style="color: #0000BB;">%2</span> in:</span></span>
<span><span class="co">#&gt; func.func @main (%x: tensor&lt;2x2xf32&gt;, %y: tensor&lt;2x2xf32&gt;) -&gt;  {</span></span>
<span><span class="co">#&gt; %0 = "stablehlo.add" (%x, %y): (tensor&lt;2x2xf32&gt;, tensor&lt;2x2xf32&gt;) -&gt; (tensor&lt;2x2xf32&gt;)</span></span>
<span><span class="co">#&gt; %1 = "stablehlo.concatenate" (%0, %x) {</span></span>
<span><span class="co">#&gt; dimension = 1 : i64</span></span>
<span><span class="co">#&gt; }: (tensor&lt;2x2xf32&gt;, tensor&lt;2x2xf32&gt;) -&gt; (tensor&lt;2x4xf32&gt;)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">%2</span> = "stablehlo.constant" () {</span></span>
<span><span class="co">#&gt; value = dense&lt;0.00000000e+00&gt; : tensor&lt;f32&gt;</span></span>
<span><span class="co">#&gt; }: () -&gt; (tensor&lt;f32&gt;)</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>Next, we add the reduce operation to our main function and specify
the dimensions to reduce along.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_main</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlo_reduce.html">hlo_reduce</a></span><span class="op">(</span>inputs <span class="op">=</span> <span class="va">x</span>, init_values <span class="op">=</span> <span class="va">init</span>, dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1L</span><span class="op">)</span>, body <span class="op">=</span> <span class="va">reduce_func</span><span class="op">)</span></span>
<span><span class="va">out_main</span></span>
<span><span class="co">#&gt; Variable <span style="color: #0000BB;">%3</span> in:</span></span>
<span><span class="co">#&gt; func.func @main (%x: tensor&lt;2x2xf32&gt;, %y: tensor&lt;2x2xf32&gt;) -&gt;  {</span></span>
<span><span class="co">#&gt; %0 = "stablehlo.add" (%x, %y): (tensor&lt;2x2xf32&gt;, tensor&lt;2x2xf32&gt;) -&gt; (tensor&lt;2x2xf32&gt;)</span></span>
<span><span class="co">#&gt; %1 = "stablehlo.concatenate" (%0, %x) {</span></span>
<span><span class="co">#&gt; dimension = 1 : i64</span></span>
<span><span class="co">#&gt; }: (tensor&lt;2x2xf32&gt;, tensor&lt;2x2xf32&gt;) -&gt; (tensor&lt;2x4xf32&gt;)</span></span>
<span><span class="co">#&gt; %2 = "stablehlo.constant" () {</span></span>
<span><span class="co">#&gt; value = dense&lt;0.00000000e+00&gt; : tensor&lt;f32&gt;</span></span>
<span><span class="co">#&gt; }: () -&gt; (tensor&lt;f32&gt;)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">%3</span> = "stablehlo.reduce" (%x, %2)({</span></span>
<span><span class="co">#&gt;   ^bb0(%z1: tensor&lt;f32&gt;, %z2: tensor&lt;f32&gt;):</span></span>
<span><span class="co">#&gt;     %4 = "stablehlo.add" (%z1, %z2): (tensor&lt;f32&gt;, tensor&lt;f32&gt;) -&gt; (tensor&lt;f32&gt;)</span></span>
<span><span class="co">#&gt;     "stablehlo.return"(%4): (tensor&lt;f32&gt;) -&gt; ()</span></span>
<span><span class="co">#&gt; }) {</span></span>
<span><span class="co">#&gt; dimensions = array&lt;i64: 0, 1&gt;</span></span>
<span><span class="co">#&gt; }: (tensor&lt;2x2xf32&gt;, tensor&lt;f32&gt;) -&gt; (tensor&lt;f32&gt;)</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>Finally, we return the result of the main function via
<code><a href="../reference/hlo_return.html">hlo_return()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hlo_return.html">hlo_return</a></span><span class="op">(</span><span class="va">out_main</span><span class="op">)</span></span>
<span><span class="co">#&gt; func.func @main (%x: tensor&lt;2x2xf32&gt;, %y: tensor&lt;2x2xf32&gt;) -&gt; tensor&lt;f32&gt; {</span></span>
<span><span class="co">#&gt; %0 = "stablehlo.add" (%x, %y): (tensor&lt;2x2xf32&gt;, tensor&lt;2x2xf32&gt;) -&gt; (tensor&lt;2x2xf32&gt;)</span></span>
<span><span class="co">#&gt; %1 = "stablehlo.concatenate" (%0, %x) {</span></span>
<span><span class="co">#&gt; dimension = 1 : i64</span></span>
<span><span class="co">#&gt; }: (tensor&lt;2x2xf32&gt;, tensor&lt;2x2xf32&gt;) -&gt; (tensor&lt;2x4xf32&gt;)</span></span>
<span><span class="co">#&gt; %2 = "stablehlo.constant" () {</span></span>
<span><span class="co">#&gt; value = dense&lt;0.00000000e+00&gt; : tensor&lt;f32&gt;</span></span>
<span><span class="co">#&gt; }: () -&gt; (tensor&lt;f32&gt;)</span></span>
<span><span class="co">#&gt; %3 = "stablehlo.reduce" (%x, %2)({</span></span>
<span><span class="co">#&gt;   ^bb0(%z1: tensor&lt;f32&gt;, %z2: tensor&lt;f32&gt;):</span></span>
<span><span class="co">#&gt;     %4 = "stablehlo.add" (%z1, %z2): (tensor&lt;f32&gt;, tensor&lt;f32&gt;) -&gt; (tensor&lt;f32&gt;)</span></span>
<span><span class="co">#&gt;     "stablehlo.return"(%4): (tensor&lt;f32&gt;) -&gt; ()</span></span>
<span><span class="co">#&gt; }) {</span></span>
<span><span class="co">#&gt; dimensions = array&lt;i64: 0, 1&gt;</span></span>
<span><span class="co">#&gt; }: (tensor&lt;2x2xf32&gt;, tensor&lt;f32&gt;) -&gt; (tensor&lt;f32&gt;)</span></span>
<span><span class="co">#&gt; "func.return"(%3): (tensor&lt;f32&gt;) -&gt; ()</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>If we want to run this function, we need the {pjrt} package. You can
learn about the package in the <a href="https://r-xla.github.io/pjrt/articles/pjrt.html" class="external-link">pjrt
documentation</a>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-xla.github.io/pjrt/" class="external-link">pjrt</a></span><span class="op">)</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/repr.html">repr</a></span><span class="op">(</span><span class="va">main_func</span><span class="op">)</span></span>
<span><span class="va">program</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/pjrt/reference/pjrt_program.html" class="external-link">pjrt_program</a></span><span class="op">(</span><span class="va">src</span><span class="op">)</span></span>
<span><span class="va">executable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/pjrt/reference/pjrt_compile.html" class="external-link">pjrt_compile</a></span><span class="op">(</span><span class="va">program</span><span class="op">)</span></span></code></pre></div>
<p>Next, we create some input values and run the function.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_buf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/pjrt/reference/pjrt_buffer.html" class="external-link">pjrt_buffer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span><span class="va">x_buf</span></span>
<span><span class="co">#&gt; PJRTBuffer </span></span>
<span><span class="co">#&gt;  1.0000 3.0000</span></span>
<span><span class="co">#&gt;  2.0000 4.0000</span></span>
<span><span class="co">#&gt; [ CPUf32{2x2} ]</span></span>
<span><span class="va">y_buf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/pjrt/reference/pjrt_buffer.html" class="external-link">pjrt_buffer</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span><span class="va">y_buf</span></span>
<span><span class="co">#&gt; PJRTBuffer </span></span>
<span><span class="co">#&gt;  5.0000 7.0000</span></span>
<span><span class="co">#&gt;  6.0000 8.0000</span></span>
<span><span class="co">#&gt; [ CPUf32{2x2} ]</span></span>
<span><span class="va">out_buf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/pjrt/reference/pjrt_execute.html" class="external-link">pjrt_execute</a></span><span class="op">(</span><span class="va">executable</span>, <span class="va">x_buf</span>, <span class="va">y_buf</span><span class="op">)</span></span>
<span><span class="va">out_buf</span></span>
<span><span class="co">#&gt; PJRTBuffer </span></span>
<span><span class="co">#&gt;  10.0000</span></span>
<span><span class="co">#&gt; [ CPUf32{} ]</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Falbel, Sebastian Fischer, Nikolai German.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
