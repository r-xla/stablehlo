---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# stablehlo

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
![R-CMD-check](https://github.com/r-xla/stablehlo/actions/workflows/R-CMD-check.yaml/badge.svg)
[![CRAN status](https://www.r-pkg.org/badges/version/stablehlo)](https://CRAN.R-project.org/package=stablehlo)
[![codecov](https://codecov.io/gh/r-xla/stablehlo/branch/main/graph/badge.svg)](https://codecov.io/gh/r-xla/stablehlo)
<!-- badges: end -->

The {stablehlo} R package provides a functional API to create [stableHLO](https://openxla.org/stablehlo) programs.
These programs can be executed using the R package [pjrt](https://github.com/r-xla/pjrt).

## Installation

From GitHub:

``` r
pak::pak("r-xla/stablehlo")
```

You can also install from
[r-universe](https://r-xla.r-universe.dev/builds), by adding the code
below to your `.Rprofile`.

``` r
options(repos = c(
  rxla = "https://r-xla.r-universe.dev",
  CRAN = "https://cloud.r-project.org/"
))
```

## Quickstart

Below, we create a function that takes two input arguments `x` and `y` of type `f32` and shape `(2, 2)` and adds them.
Passing `func` to `hlo_input()` is optional, because it will automatically use the last function created with `hlo_func()`.

```{r}
library(stablehlo)
func <- hlo_func("myfn")
func
x <- hlo_input("x", "f32", shape = c(2, 2), func = func)
x
y <- hlo_input("y", "f32", shape = c(2, 2), func = func)
y
z <- hlo_add(x, y)
z
f <- hlo_return(z)
identical(f, func)
f
```

## Main Features

* Implements type inference to easily build up stableHLO programs.
* Simple, functional API.
* Clear error messages.
* Easy installation because the implementation is in R and does not depend on the stableHLO C++ builder, which depends on LLVM and MLIR.

## Important notes

stableHLO uses 0-based indexing. Wherever operations take dimension indices
(e.g., axes, start indices, permutation dimensions), use 0-based values.
This differs from R's 1-based indexing.

## Limitations

The R package is a *partial* implementation of the stableHLO specification.
At least initially, it will:

* only support a subset of the available operations, see [this issue](https://github.com/r-xla/stablehlo/issues/6) for an overview.
* not support all data types, e.g. quantized types and complex numbers are not supported.
* not support shape dynamism.

## Acknowledgments

* This work is supported by [MaRDI](https://www.mardi4nfdi.de).
* This work is built upon the [stableHLO specification](https://openxla.org/stablehlo/spec) from the OpenXLA project.
